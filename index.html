<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Výkaz práce</title>

    <link rel="stylesheet" href="style.css" />

    <!-- Pomůže pro rychlejší navázání -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://unpkg.com" crossorigin>

    <!-- Knihovny, které app.js používá (můžou být ready předem) -->
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>
  </head>

  <body>
    <header class="topbar">
      <h1>Výkaz práce</h1>
    </header>

    <main id="app" class="wrap"></main>

    <div id="err" class="toast" style="display:none"></div>

    <!-- FAB pro otevření nástrojů -->
    <button id="openDrawerBtn" class="fab" aria-label="Otevřít nástroje">+</button>

    <!-- Overlay + Drawer (zůstává skrytý, ovládá drawer.js) -->
    <div id="drawerOverlay" aria-hidden="true"></div>

    <aside
      id="toolsDrawer"
      class="drawer"
      role="dialog"
      aria-label="Nástroje"
      aria-hidden="true">

      <header class="drawer-head">
        <h3>Nástroje</h3>
        <button id="drawerCloseBtn" class="icon-btn" aria-label="Zavřít">×</button>
      </header>

      <section class="drawer-sec">
        <h4>Přidání zakázky</h4>
        <label class="sr-only" for="newJobClient">Klient</label>
        <select id="newJobClient" class="pill-select"></select>

        <label class="sr-only" for="newJobName">Název zakázky</label>
        <input id="newJobName" class="pill-input" placeholder="Název zakázky" />

        <label class="sr-only" for="newJobStatus">Stav</label>
        <select id="newJobStatus" class="pill-select"></select>

        <button id="addJobBtn" class="pill-btn accent" style="margin-top:12px;">
          Přidat zakázku
        </button>
      </section>

      <section class="drawer-sec">
        <h4>Přidání klienta</h4>
        <label class="sr-only" for="newClientName">Název klienta</label>
        <input id="newClientName" class="pill-input" placeholder="Název klienta" />
        <button id="addClientBtn" class="pill-btn" style="margin-top:12px;">
          Přidat klienta
        </button>
      </section>

      <section class="drawer-sec">
        <h4>Účet</h4>
        <button id="logoutBtn" class="pill-btn">Odhlásit</button>
      </section>
    </aside>

    <!-- BOOTSTRAP: načti Supabase a až POTOM app.js + drawer.js -->
    <script>
      (function bootstrap() {
        function load(src) {
          return new Promise(function (resolve, reject) {
            var s = document.createElement('script');
            s.src = src;
            s.onload = resolve;
            s.onerror = reject;
            document.head.appendChild(s);
          });
        }

        // Zkus jsDelivr, při chybě unpkg
        function loadSupabaseUMD() {
          return load('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.js')
            .catch(function () {
              return load('https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js');
            });
        }

        // Po načtení Supabase injektuj app.js a až poté drawer.js (kvůli pořadí)
        loadSupabaseUMD().then(function () {
          if (!window.supabase || !window.supabase.createClient) {
            console.error('Supabase UMD se nenačetl – zkusí se unpkg fallback.');
          }

          return load('app.js').then(function () {
            return load('drawer.js');
          });
        }).catch(function (e) {
          console.error('Nepodařilo se načíst Supabase:', e);
          // Minimalistický toast do tvojí existující chybové vrstvy
          var t = document.getElementById('err');
          if (t) {
            t.textContent = 'Nepodařilo se načíst knihovnu Supabase. Zkuste prosím obnovit stránku.';
            t.style.display = 'block';
          }
        });
      })();
    </script>
  </body>
</html>
